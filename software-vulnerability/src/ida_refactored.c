int __cdecl main(int argc, const char **argv, const char **envp)
{
  FILE *fd1; // eax
  FILE *fd2; // edi
  size_t cpyLen; // esi
  _BYTE Src[4096]; // [esp+4h] [ebp-1140h] BYREF
  _BYTE v8[260]; // [esp+1004h] [ebp-140h] BYREF
  _BMPHEADER *Buffer; // [esp+1108h] [ebp-3Ch] BYREF
  int bfOffBits; // [esp+1112h] [ebp-32h]
  int biWidth; // [esp+111Ah] [ebp-2Ah]
  int biHeight; // [esp+111Eh] [ebp-26h]
  __int16 biBitCount; // [esp+1124h] [ebp-20h]
  size_t ElementSize; // [esp+112Ah] [ebp-1Ah]


  if ( argc == 2 )
  {
    memset(Src, 0, sizeof(Src));
    fd1 = fopen(argv[1], "rb");
    fd2 = fd1;
    if ( fd1 )
    {
      fread(&Buffer, 0x36u, 1u, fd1);
      if ( (_WORD)Buffer == 19778 )
      {
        if ( biBitCount == 24 )
        {
          cpyLen = 3 * biWidth * biHeight;
          fseek(fd2, bfOffBits, 0);
          fread(Src, ElementSize, 1u, fd2);
          memcpy(v8, Src, cpyLen);
          fclose(fd2);
          return 0;
        }
        else
        {
          perror("This program only supports 24-bit BMP files.");
          fclose(fd2);
          return 4;
        }
      }
      else
      {
        perror("Not a BMP file.");
        fclose(fd2);
        return 3;
      }
    }
    else
    {
      perror("Error opening file");
      return 2;
    }
  }
  else
  {
    sub_401010("Usage: %s <file_path>\n", (char)*argv);
    return 1;
  }
}